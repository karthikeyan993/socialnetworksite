<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Social Networking Website!</title>
    <link rel="stylesheet" href="./resources/css/style.css">
    <link rel="stylesheet" href="./resources/css/responsive.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
</head>
<body>
    <div id="wrapper">
        <button id="newpost" onclick="newaction()" type="button">
            <ion-icon id="newicon" name="add-outline"></ion-icon>
        </button>
        <div class="modal">
            <div class="modalmenu">
                <ul id="list">
                    <li class="listitem"><input id="radiotext" type="radio" name="radioinput">Text Post</li>
                    <li class="listitem"><input type="radio" name="radioinput">Image Post</li>
                    <li class="listitem"><input type="radio" name="radioinput">Poll Post</li>
                </ul>
                <button type="button" id="closemenu">
                    <ion-icon class="close-icon"  name="close-circle-outline"></ion-icon>
                </button>
    
                <button type="button" id="formnext"><p>Next</p></button>
            </div>
            <div class="modal1">
                <div class="modalform">
                    <p id="modallabel">Text Input</p>
                    <input id="modal1input" type="textarea" name="textpost"><br>
                    <button id="modal1submit"  onclick="newtextpost()" type="button">Submit</button>
                    <button id="modal1back" type="button">Back</button>
                </div>
    
                <button type="button" id="closetext">
                    <ion-icon class="close-icon"  name="close-circle-outline"></ion-icon>
                </button>
            </div>
    
        </div>
        
    </div>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script>
        let indexdata;
        mainbox();
        function mainbox(){
            let i;
            var container="";
            var bodycontainer=document.getElementById("wrapper").innerHTML;
            const xhttp = new XMLHttpRequest();
            xhttp.onload=function(){
                indexdata=JSON.parse(this.responseText);
                console.log(indexdata);
                bodycontainer+=`
                
                            <div class="top-strip">
                    <div class="burger">
                        <button><ion-icon id="burger-icon" name="menu-outline"></ion-icon></button>
                    </div>
                    <div class="topleft">
                        <div class="ppage">
                            <p>PROFILE PAGE</p>
                        </div>
                        <div class="search">
                            <div id="sbox">
                                <input type="text" name="srch" placeholder="Search here for people">
                            </div>
                            <div id="searchbtn" >
                                <button id="sbtn" type="button" onclick="search()">
                                    <ion-icon name="search-outline"></ion-icon>
                                </button>
                            </div>
                        </div>
                        <div class="findf">
                            <p>FIND FRIENDS</p>
                        </div>
                    </div>
                    <div class="topcenter">
                    </div>
                    <div class="topright">
                        <div class="topnotify">
                            <ion-icon class="notiicons" name="happy-outline"></ion-icon>
                            <ion-icon class="notiicons" name="chatbubbles-outline"></ion-icon>
                            <ion-icon class="notiicons" name="flash-outline"></ion-icon>
                        </div>
                        <div class="topproname">
                            <div class="propic">
                                <img src="${indexdata[0].userphoto}" alt="Male Profile Photo">
                            </div>
                            <div class="proname">
                                <p id="topname">${indexdata[0].firstname} ${indexdata[0].lastname}<p>
                                <p id="nickname">SPACE COWBOY<p>
                            </div>
                        </div>
                    </div>
                    
                </div>
                <div class="cover">
                    <div class="coverpic">
                        <img src="./resources/images/coverphoto.jpg" alt="cover photo" width="100%">
                    </div>
                    <div class="menu">
                        <div class="time menusize menustyle" >
                            <p>Time</p>
                        </div>
                        <div class="about menusize menustyle">
                            <p>About</p>
                        </div>
                        <div class="frnd menusize menustyle">
                            <p>Friends</p>
                        </div>
                        <div class="dp menusize">
                            <div class="dppic">
                                <img src="${indexdata[0].userphoto}" alt="Profile Picture">
                            </div>
                            <div class="dpname">
                                <p id="dpname1">${indexdata[0].firstname} ${indexdata[0].lastname}</p>
                                <p id="dpname2">${indexdata[0].location}</p>
                            </div>
                        </div>
                        <div class="photos menusize menustyle">
                            <p>Photos</p>
                        </div>
                        <div class="videos menusize menustyle">
                            <p>Videos</p>
                        </div>
                        <div class="dots menusize menustyle">
                            <p>...</p>
                        </div>

                    </div>
                    <div class="menuicons">
                        <ion-icon class="coloricon color1" name="happy-outline"></ion-icon>
                        <ion-icon class="coloricon color2" name="chatbubbles-outline"></ion-icon>
                        <ion-icon class="coloricon color3" name="options-outline"></ion-icon> 
                    </div>
                </div>
                <div id="box">
                </div>
                
                `;
                document.getElementById("wrapper").innerHTML=bodycontainer;
                for(i=indexdata.length-1;i>=0;i--){
                    if(indexdata[i].posttype==1 && indexdata[i].textpost!=""){
                        if(indexdata[i].comments!=null){
                        console.log(indexdata[i].postid);
                        var comcontainer="";
                        var comlen = indexdata[i].comments.length;
                        console.log(comlen);
                        for(let j=0;j<comlen;j++){
                            comcontainer+=`
                            <div class="comment-sec">
                                <div class="com-pro">
                                    <img src="${indexdata[i].userphoto}" alt="">
                                </div>
                                <div class="com-text">
                                    <p>${indexdata[i].comments[j].text}</p>
                                </div>
                            </div>
                        `;
                        
                    }
                                        container+=`
                        
                        
                        <div class="box1">
                        <div class="box1head">
                            <div class="box1dp">
                                <img src="${indexdata[i].userphoto}" alt="Profile Photo">
                            </div>
                            <div class="box1name">
                                <p id="box1dpname">${indexdata[i].firstname} ${indexdata[i].lastname}</p>
                                <p id="box1time">19 hours ago</p>
                            </div>
                            <div class="box1dummy">

                            </div>
                            <div class="box1dot">
                                <p>...</p>
                            </div>
                        </div>
                        <div class="box1post a${indexdata[i].postid}">
                            <p>${indexdata[i].textpost}</p>
                        </div>
                        <div class="box1foot">
                            <div class="box1heart">
                                <div class="${indexdata[i].likeduser!=null?"likebtn like":"likebtn"}" data-post="${indexdata[i].postid}">
                                    
                                    <svg id="heart" viewBox="0 0 24 24" fill="grey"><path d="M12 4.435c-1.989-5.399-12-4.597-12 3.568 0 4.068 3.06 9.481 12 14.997 8.94-5.516 12-10.929 12-14.997 0-8.118-10-8.999-12-3.568z"/></svg>
                                    <input type ="text" class="likecount" value="${indexdata[i].postlikes}">
                                </div>                                
                            </div>
                            
                            <div class="box1frndspic">
                                <img id="friend1" src="./resources/images/stranger1.jpg" alt="Friend photo">
                                <img id="friend2" src="./resources/images/stranger2.jpg" alt="Friend photo">
                                <img id="friend3" src="./resources/images/stranger3.jpg" alt="Friend photo">
                                <img id="friend4" src="./resources/images/stranger4.jpg" alt="Friend photo">
                                <img id="friend5" src="./resources/images/stranger5.jpg" alt="Friend photo">
                            </div>
                            <div class="box1frndsname">
                                <p><b>Jenny</b>, <b>Robert</b> and<br> 6 more liked this</p>
                            </div>
                            <div class="box1footdum">
                            </div>
                            <div class="box1noti">
                                <div class="box1comm">
                                    <ion-icon class="box1chat"name="chatbox-ellipses-outline"></ion-icon>
                                    <p class="comnum">17</p>
                                </div>
                                <div class="box1share">
                                    <ion-icon class="box1chat" name="trail-sign-outline"></ion-icon>
                                    <p class="comnum">24</p>
                                </div>
                            </div>
                           
                        </div>
                        <div class="oldcomments" id="combox">
                           `+comcontainer+`
                        </div>
                        <div class="comment-sec">
                            <div class="com-pro">
                                <img src="${indexdata[i].userphoto}" alt="Profile Photo">
                            </div>
                            <div class="com-text">
                                <textarea id="com-area" placeholder="say something about this post..."></textarea>
                            </div>
                        </div>
                        <div class="com-post">
                            <button id="com-postbtn" onclick="compost()" data-post="${indexdata[i].postid}">post</button>
                        </div>
                    </div>`;

                    

                    
                    }
                    

                    } else if (indexdata[i].posttype==2 && indexdata[i].imagelink!=""){
                        container+=`
                                    <div class="box2">
                        <div class="box1head">
                            <div class="box1dp">
                                <img src="./resources/images/profilephoto.jpg" alt="Profile Photo">
                            </div>
                            <div class="box1name">
                                <p id="box1dpname">James Speigel</p>
                                <p id="box1time">19 hours ago</p>
                            </div>
                            <div class="box1dummy">

                            </div>
                            <div class="box1dot">
                                <p>...</p>
                            </div>
                        </div>
                        <div class="box2post">
                            <div class="descrip">
                                <p>${indexdata[i].imagedescrip}</p>
                            </div>
                            <div class="imgpost">
                                <img src="${indexdata[i].imagelink}" alt="Girl Photo">
                            </div>
                        </div>
                        <div class="box1foot">
                            <div class="box1heart">
                                <div class="${indexdata[i].likeduser!=null?"likebtn like":"likebtn"}" data-post="${indexdata[i].postid}">
                                    
                                    <svg id="heart" viewBox="0 0 24 24" fill="grey"><path d="M12 4.435c-1.989-5.399-12-4.597-12 3.568 0 4.068 3.06 9.481 12 14.997 8.94-5.516 12-10.929 12-14.997 0-8.118-10-8.999-12-3.568z"/></svg>
                                    <input type ="text" class="likecount" value="${indexdata[i].postlikes}">
                                </div>                                
                            </div>
                            <div class="box1frndspic">
                                <img id="friend1" src="./resources/images/stranger1.jpg" alt="Friend photo">
                                <img id="friend2" src="./resources/images/stranger2.jpg" alt="Friend photo">
                                <img id="friend3" src="./resources/images/stranger3.jpg" alt="Friend photo">
                                <img id="friend4" src="./resources/images/stranger4.jpg" alt="Friend photo">
                                <img id="friend5" src="./resources/images/stranger5.jpg" alt="Friend photo">
                            </div>
                            <div class="box1frndsname">
                                <p><b>Jenny</b>, <b>Robert</b> and<br> 6 more liked this</p>
                            </div>
                            <div class="box1footdum">
                            </div>
                            <div class="box1noti">
                                <div class="box1comm">
                                    <ion-icon class="box1chat"name="chatbox-ellipses-outline"></ion-icon>
                                    <p class="comnum">17</p>
                                </div>
                                <div class="box1share">
                                    <ion-icon class="box1chat" name="trail-sign-outline"></ion-icon>
                                    <p class="comnum">24</p>
                                </div>
                            </div>
                        </div>
                    </div>
                        `;
                    } else if(indexdata[i].posttype==3 && indexdata[i].pollque!="" && indexdata[i].option1!="" && indexdata[i].option2!=""){
                        container+=`
                                    <div class="box3">
                    <div class="box1head">
                        <div class="box1dp">
                            <img src="./resources/images/profilephoto.jpg" alt="Profile Photo">
                        </div>
                        <div class="box1name">
                            <p id="box1dpname">James Speigel</p>
                            <p id="box1time">19 hours ago</p>
                        </div>
                        <div class="box1dummy">

                        </div>
                        <div class="box1dot">
                            <p>...</p>
                        </div>
                    </div>
                    <div id="poll" class="box3post">
                            <div class="que">
                                <p>${indexdata[i].pollque}</p>
                            </div>
                            <div class="options">
                                <input type="radio" id="option1" checked="checked" name="answer">
                                <label for="option1">${indexdata[i].option1}</label><br>
                                <input type="radio" id="option2" name="answer">
                                <label for="option2">${indexdata[i].option2}</label><br>
                                <input type="radio" id="option3" name="answer">
                                <label for="option3">${indexdata[i].option3}</label><br>
                                <input type="radio" id="option4" name="answer">
                                <label for="option4">${indexdata[i].option4}</label>
                            </div>
                            <div class="submit">
                                <button id="submitbtn" onclick="result()">Submit</button>
                            </div>
                    </div>
                    <div class="box1foot">
                        <div class="box1heart">
                                <div class="${indexdata[i].likeduser!=null?"likebtn like":"likebtn"}" data-post="${indexdata[i].postid}">
                                    
                                    <svg id="heart" viewBox="0 0 24 24" fill="grey"><path d="M12 4.435c-1.989-5.399-12-4.597-12 3.568 0 4.068 3.06 9.481 12 14.997 8.94-5.516 12-10.929 12-14.997 0-8.118-10-8.999-12-3.568z"/></svg>
                                    <input type ="text" class="likecount" value="${indexdata[i].postlikes}">
                                </div>                                
                            </div>
                        <div class="box1frndspic">
                            <img id="friend1" src="./resources/images/stranger1.jpg" alt="Friend photo">
                            <img id="friend2" src="./resources/images/stranger2.jpg" alt="Friend photo">
                            <img id="friend3" src="./resources/images/stranger3.jpg" alt="Friend photo">
                            <img id="friend4" src="./resources/images/stranger4.jpg" alt="Friend photo">
                            <img id="friend5" src="./resources/images/stranger5.jpg" alt="Friend photo">
                        </div>
                        <div class="box1frndsname">
                            <p><b>Jenny</b>, <b>Robert</b> and<br> 6 more liked this</p>
                        </div>
                        <div class="box1footdum">
                        </div>
                        <div class="box1noti">
                            <div class="box1comm">
                                <ion-icon class="box1chat"name="chatbox-ellipses-outline"></ion-icon>
                                <p class="comnum">17</p>
                            </div>
                            <div class="box1share">
                                <ion-icon class="box1chat" name="trail-sign-outline"></ion-icon>
                                <p class="comnum">24</p>
                            </div>
                        </div>
                    </div>
                </div>
                        `;
                    }
                }


                document.getElementById("box").innerHTML = container;
                
                var btn1 = document.querySelector('.likebtn');
                var btns1 = document.querySelectorAll('.likebtn');
                var lc = document.querySelector('.likecount');
                var lc1 = document.querySelectorAll('.likecount');

                btns1.forEach( btn1 => {
                    btn1.addEventListener('click', function (){
                    if (btn1.classList.contains('like')) {
                        btn1.classList.remove('like');
                        this.children[1].value= parseInt(this.children[1].value) - 1;
                        
                        
                        const xhttp = new XMLHttpRequest();
                        xhttp.open("POST","http://localhost/socialnetwork/likes.php");
                        xhttp.setRequestHeader("Content-Type", "application/json");
                        xhttp.onload=function(){
                        
                        }
                        var likemsg;
                        likemsg = this.dataset.post;
                        var likepost;
                        let liketype;
                        liketype="delete";
                        likepost={'type':liketype,'likemsg':likemsg};
                        xhttp.send(JSON.stringify(likepost));
                

                    } else {
                        btn1.classList.add('like');
                        this.children[1].value= parseInt(this.children[1].value) + 1;
                        //console.log(this.parentElement.parentElement.parentElement.children[1].classList[1]);
                        const xhttp = new XMLHttpRequest();
                        xhttp.open("POST","http://localhost/socialnetwork/likes.php");
                        xhttp.setRequestHeader("Content-Type", "application/json");
                        xhttp.onload=function(){
                        }
                        var likemsg;
                        likemsg = this.dataset.post;
                        let liketype;
                        liketype="insert";
                        let likepost;
                        likepost={'type':liketype,'likemsg':likemsg};
                        xhttp.send(JSON.stringify(likepost));

                    }
               
                    }); // end of add listner
                }); //end of for each
                
                


            } //end of onload function
        
            xhttp.open("GET","http://localhost/socialnetwork/file.php");
            xhttp.send();
        }

        

        function result(){
            const xhttp = new XMLHttpRequest();
            xhttp.onload=function(){
                document.getElementById("poll").innerHTML=this.responseText;
            }
            xhttp.open("GET","http://localhost/socialnetwork/database.php");
            xhttp.send();
        }

         function newtextpost(){
            const xhttp = new XMLHttpRequest();
            xhttp.open("POST","http://localhost/socialnetwork/backend.php");
            xhttp.setRequestHeader("Content-Type", "application/json");
            xhttp.onload=function(){
                alert("new indexdata created");  
            }
            var input;
            input=document.getElementById('modal1input').value;
            var indexdata;
            indexdata={'name':input,type:"insert"};
            xhttp.send(JSON.stringify(indexdata));
           // makealert();
        }
        
        function compost(){

            const xhttp = new XMLHttpRequest();
            xhttp.open("POST","http://localhost/socialnetwork/comment.php");
            xhttp.setRequestHeader("Content-Type", "application/json");
            xhttp.onload=function(){
                
            }
            var input;
            input=document.getElementById('com-area').value;
            var indexdata;
            var commsg;
            console.log(this);
            comemsg = this.dataset.post;
            indexdata={'input':input,'commsg':commsg};
            xhttp.send(JSON.stringify(indexdata));
        }

        function newaction(){
            document.getElementById('newpost').addEventListener('click',function(){
                document.querySelector('.modal').style.display='flex';
                document.querySelector('.modalmenu').style.display='flex';

            });
                document.getElementById('closemenu').addEventListener('click',function(){
                document.querySelector('.modal').style.display='none';
                document.querySelector('.modalmenu').style.display='none';

            });
                document.getElementById('closetext').addEventListener('click',function(){
                document.querySelector('.modal').style.display='none';
                document.querySelector('.modal1').style.display='none';

            });

            document.getElementById('modal1back').addEventListener('click',function(){
                document.querySelector('.modalmenu').style.display='flex';
                document.querySelector('.modal1').style.display='none';

            });

            
            document.getElementById('formnext').addEventListener('click',function(){

            if(document.getElementById('radiotext').checked==true){

                document.querySelector('.modalmenu').style.display='none';
                document.querySelector('.modal1').style.display='flex';
            } else if(document.getElementById('radioimage').checked==true){
                document.querySelector('.modalmenu').style.display='none';
                document.querySelector('.modal2').style.display='flex';
            } else if(document.getElementById('radiopoll').checked==true){
                document.querySelector('.modalmenu').style.display='none';
                document.querySelector('.modal3').style.display='flex';
            } else{
                window.alert("Please select an option");
            }
            });

        }
    
        
    </script>

</body>
</html>